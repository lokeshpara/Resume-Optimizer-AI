<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Optimizer - Mobile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }

        .api-keys {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .api-keys h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 10px;
        }

        .key-input {
            margin-bottom: 10px;
        }

        .key-input label {
            font-size: 12px;
            color: #666;
        }

        .key-input input {
            font-size: 14px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
            font-size: 14px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.processing {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #856404;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .links {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }

        .links a {
            display: block;
            padding: 10px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 8px;
            text-align: center;
            font-size: 14px;
        }

        .toggle-keys {
            font-size: 12px;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 5px;
            display: inline-block;
        }

        .progress {
            margin-top: 10px;
        }

        .progress-step {
            font-size: 13px;
            color: #666;
            margin: 5px 0;
            padding-left: 20px;
        }

        .progress-step.active {
            color: #667eea;
            font-weight: 600;
        }

        .progress-step.done {
            color: #28a745;
        }

        .progress-step::before {
            content: "‚óã ";
            margin-right: 5px;
        }

        .progress-step.active::before {
            content: "‚óè ";
        }

        .progress-step.done::before {
            content: "‚úì ";
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÑ Resume Optimizer</h1>
        <p class="subtitle">92-100% ATS Match Rate</p>

        <div class="input-group">
            <label for="aiProvider">AI Provider</label>
            <select id="aiProvider" onchange="toggleApiKeys()">
                <option value="gemini">Gemini AI</option>
                <option value="chatgpt">ChatGPT</option>
            </select>
        </div>

        <div class="api-keys" id="apiKeysSection">
            <h3>API Keys</h3>
            <div id="geminiKeys">
                <div class="key-input">
                    <label>Gemini Key 1</label>
                    <input type="password" id="geminiKey1" placeholder="Enter Gemini API Key 1">
                </div>
                <div class="key-input">
                    <label>Gemini Key 2</label>
                    <input type="password" id="geminiKey2" placeholder="Enter Gemini API Key 2">
                </div>
                <div class="key-input">
                    <label>Gemini Key 3</label>
                    <input type="password" id="geminiKey3" placeholder="Enter Gemini API Key 3">
                </div>
            </div>
            <div id="chatgptKeys" style="display: none;">
                <div class="key-input">
                    <label>ChatGPT API Key</label>
                    <input type="password" id="chatgptKey" placeholder="Enter ChatGPT API Key">
                </div>
            </div>
            <span class="toggle-keys" onclick="toggleShowKeys()">üëÅÔ∏è Show/Hide Keys</span>
        </div>

        <div class="input-group">
            <label for="jobUrl">Job URL (Optional)</label>
            <input type="text" id="jobUrl" placeholder="https://www.linkedin.com/jobs/view/...">
        </div>

        <div class="input-group">
            <label for="jobDescription">Job Description (Paste here)</label>
            <textarea id="jobDescription" placeholder="Paste the job description here..."></textarea>
        </div>

        <button class="btn" onclick="optimizeResume()" id="optimizeBtn">
            üöÄ Optimize Resume
        </button>

        <div class="status" id="status"></div>

        <div class="progress" id="progress" style="display: none;">
            <div class="progress-step" id="step1">Extracting job details...</div>
            <div class="progress-step" id="step2">Fetching original resume...</div>
            <div class="progress-step" id="step3">Generating optimization points...</div>
            <div class="progress-step" id="step4">Rewriting resume...</div>
            <div class="progress-step" id="step5">Quality check...</div>
            <div class="progress-step" id="step6">Creating document...</div>
        </div>

        <div class="links" id="links" style="display: none;">
            <a href="#" id="googleDocsLink" target="_blank">üìù Open in Google Docs</a>
            <a href="#" id="pdfLink" target="_blank">üì• Download PDF</a>
            <a href="#" id="trackingLink" target="_blank">üìä View Tracking Sheet</a>
        </div>
    </div>

    <script>
        const SERVER_URL = 'https://9bf46f5d9478.ngrok-free.app'; // Change this to your server URL

        function toggleApiKeys() {
            const provider = document.getElementById('aiProvider').value;
            document.getElementById('geminiKeys').style.display = provider === 'gemini' ? 'block' : 'none';
            document.getElementById('chatgptKeys').style.display = provider === 'chatgpt' ? 'block' : 'none';
        }

        let keysVisible = false;
        function toggleShowKeys() {
            keysVisible = !keysVisible;
            const type = keysVisible ? 'text' : 'password';
            document.querySelectorAll('input[type="password"], input[type="text"][id*="Key"]').forEach(input => {
                if (input.id.includes('Key')) {
                    input.type = type;
                }
            });
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
            status.style.display = 'block';
        }

        function updateProgress(step) {
            for (let i = 1; i <= 6; i++) {
                const elem = document.getElementById('step' + i);
                if (i < step) {
                    elem.className = 'progress-step done';
                } else if (i === step) {
                    elem.className = 'progress-step active';
                } else {
                    elem.className = 'progress-step';
                }
            }
        }

        async function optimizeResume() {
            const btn = document.getElementById('optimizeBtn');
            const aiProvider = document.getElementById('aiProvider').value;
            const jobUrl = document.getElementById('jobUrl').value.trim();
            const jobDescription = document.getElementById('jobDescription').value.trim();

            // Validation
            if (!jobDescription && !jobUrl) {
                showStatus('‚ùå Please provide either a Job URL or paste the Job Description', 'error');
                return;
            }

            // Get API keys
            let geminiKey1, geminiKey2, geminiKey3, chatgptApiKey;
            
            if (aiProvider === 'gemini') {
                geminiKey1 = document.getElementById('geminiKey1').value.trim();
                geminiKey2 = document.getElementById('geminiKey2').value.trim();
                geminiKey3 = document.getElementById('geminiKey3').value.trim();
                
                if (!geminiKey1 || !geminiKey2 || !geminiKey3) {
                    showStatus('‚ùå Please enter all 3 Gemini API keys', 'error');
                    return;
                }
            } else {
                chatgptApiKey = document.getElementById('chatgptKey').value.trim();
                
                if (!chatgptApiKey) {
                    showStatus('‚ùå Please enter ChatGPT API key', 'error');
                    return;
                }
            }

            // Disable button
            btn.disabled = true;
            btn.textContent = '‚è≥ Optimizing...';

            // Show progress
            document.getElementById('progress').style.display = 'block';
            document.getElementById('links').style.display = 'none';
            
            showStatus('üîÑ Processing resume optimization...', 'processing');

            try {
                // Simulate progress updates
                updateProgress(1);
                await new Promise(resolve => setTimeout(resolve, 500));
                updateProgress(2);

                const response = await fetch(`${SERVER_URL}/api/optimize-resume`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        jobUrl: jobUrl || null,
                        currentPageUrl: jobUrl || null,
                        aiProvider: aiProvider,
                        geminiKey1: geminiKey1 || null,
                        geminiKey2: geminiKey2 || null,
                        geminiKey3: geminiKey3 || null,
                        chatgptApiKey: chatgptApiKey || null,
                        manualJobDescription: jobDescription || null
                    })
                });

                updateProgress(3);

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Optimization failed');
                }

                updateProgress(6);

                // Show success
                showStatus(`‚úÖ ${data.status}\nüìä ${data.optimizationPoints} optimization points applied\nüéØ ATS Score: ${data.atsScore}`, 'success');

                // Show links
                document.getElementById('googleDocsLink').href = data.links.editInGoogleDocs;
                document.getElementById('pdfLink').href = data.links.downloadPDF;
                document.getElementById('trackingLink').href = data.links.trackingSheet;
                document.getElementById('links').style.display = 'block';

            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
                console.error('Optimization error:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = 'üöÄ Optimize Resume';
                setTimeout(() => {
                    document.getElementById('progress').style.display = 'none';
                }, 2000);
            }
        }

        // Load saved API keys from localStorage
        window.onload = function() {
            if (localStorage.getItem('geminiKey1')) {
                document.getElementById('geminiKey1').value = localStorage.getItem('geminiKey1');
            }
            if (localStorage.getItem('geminiKey2')) {
                document.getElementById('geminiKey2').value = localStorage.getItem('geminiKey2');
            }
            if (localStorage.getItem('geminiKey3')) {
                document.getElementById('geminiKey3').value = localStorage.getItem('geminiKey3');
            }
            if (localStorage.getItem('chatgptKey')) {
                document.getElementById('chatgptKey').value = localStorage.getItem('chatgptKey');
            }

            // Save keys when changed
            document.querySelectorAll('input[id*="Key"]').forEach(input => {
                input.addEventListener('change', function() {
                    localStorage.setItem(this.id, this.value);
                });
            });
        };
    </script>
</body>
</html>